<template>
  <div class="main-container">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="515"
      height="459"
      viewBox="0 0 515 459"
      fill="none"
      style="width: 75%; height: 75%"
    >
      <defs>
        <linearGradient
          id="paint0_linear"
          x1="197.912"
          y1="109"
          x2="334.551"
          y2="207.701"
          gradientUnits="userSpaceOnUse"
        >
          <stop stop-color="#40A9F5" />
          <stop offset="1" stop-color="#90D0FE" />
        </linearGradient>
        <linearGradient
          id="paint1_linear"
          x1="-8.5"
          y1="5.99998"
          x2="177"
          y2="6"
          gradientUnits="userSpaceOnUse"
        >
          <stop stop-color="#56A2F5" />
          <stop offset="1" stop-color="#69C1FF" />
        </linearGradient>
        <linearGradient
          id="paint2_linear"
          x1="323.088"
          y1="319"
          x2="186.449"
          y2="220.299"
          gradientUnits="userSpaceOnUse"
        >
          <stop stop-color="#40A9F5" />
          <stop offset="1" stop-color="#90D0FE" />
        </linearGradient>
        <linearGradient
          id="paint3_linear"
          x1="-8.5"
          y1="5.99998"
          x2="177"
          y2="6"
          gradientUnits="userSpaceOnUse"
        >
          <stop stop-color="#56A2F5" />
          <stop offset="1" stop-color="#69C1FF" />
        </linearGradient>
        <linearGradient
          id="paint4_linear"
          x1="286"
          y1="244.5"
          x2="492"
          y2="471"
          gradientUnits="userSpaceOnUse"
        >
          <stop stop-color="white" />
          <stop offset="1" stop-color="#D7CFCF" />
        </linearGradient>
        <linearGradient
          id="paint5_linear"
          x1="413.182"
          y1="354.788"
          x2="286"
          y2="330.942"
          gradientUnits="userSpaceOnUse"
        >
          <stop stop-color="#F8C248" />
          <stop offset="1" stop-color="#F39032" />
        </linearGradient>
        <linearGradient
          id="paint6_linear"
          x1="385.382"
          y1="362.541"
          x2="340.639"
          y2="361.894"
          gradientUnits="userSpaceOnUse"
        >
          <stop stop-color="#F8C248" />
          <stop offset="1" stop-color="#F37F35" />
        </linearGradient>
        <linearGradient
          id="paint7_linear"
          x1="352.774"
          y1="282.48"
          x2="371.019"
          y2="315.725"
          gradientUnits="userSpaceOnUse"
        >
          <stop stop-color="#F8C248" />
          <stop offset="1" stop-color="#F37F35" />
        </linearGradient>
      </defs>
      <rect width="515" height="459" fill="#E5E5E5" />
      <g id="Desktop - 1">
        <rect width="2129" height="4725" transform="translate(-1147 -1192)" fill="white" />
        <g id="PaymentPending">
          <path
            id="Vector"
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M302.523 130.506C359.096 160.46 454.354 134.889 473.431 193.029C492.17 250.135 410.453 280.438 362.437 313.097C329 335.839 291.28 346.133 248.595 345.955C195.905 345.734 130.002 355.528 99.6892 311.998C69.5473 268.712 117.196 222.439 129.469 174.883C142.441 124.617 119.259 46.6611 171.631 33.231C224.426 19.6925 251.915 103.709 302.523 130.506Z"
            fill="#0C7DCE"
          />
          <g id="stars">
            <path
              id="star-1"
              d="M81.4866 361.731C80.6473 358.114 84.7607 355.405 87.7525 357.604L92.6104 361.176C93.551 361.867 94.7468 362.113 95.884 361.85L101.757 360.487C105.375 359.647 108.084 363.761 105.884 366.752L102.313 371.61C101.621 372.551 101.375 373.747 101.639 374.884L103.002 380.757C103.842 384.375 99.7281 387.084 96.7363 384.884L91.8784 381.313C90.9378 380.621 89.742 380.375 88.6048 380.639L82.7313 382.002C79.1142 382.841 76.4049 378.728 78.6044 375.736L82.1759 370.878C82.8674 369.938 83.1135 368.742 82.8496 367.605L81.4866 361.731Z"
              fill="#FDC54E"
            />
            <path
              id="star-3"
              d="M68.7052 17.0813C69.2715 13.4115 74.0976 12.4267 76.0565 15.5812L82.5219 25.9929C83.1378 26.9847 84.1562 27.6579 85.31 27.8359L97.4224 29.7052C101.092 30.2715 102.077 35.0976 98.9225 37.0565L88.5108 43.5219C87.5191 44.1378 86.8458 45.1562 86.6678 46.31L84.7986 58.4224C84.2322 62.0922 79.4061 63.077 77.4472 59.9224L70.9818 49.5108C70.3659 48.519 69.3475 47.8458 68.1938 47.6678L56.0814 45.7985C52.4116 45.2322 51.4268 40.4061 54.5813 38.4472L64.9929 31.9818C65.9847 31.3659 66.6579 30.3475 66.836 29.1937L68.7052 17.0813Z"
              fill="#FDC54E"
            />
            <path
              id="star-4"
              d="M315.889 16.865C318.13 15.3105 321.095 17.3826 320.406 20.0212L318.131 28.7304C317.914 29.56 318.071 30.4428 318.56 31.1473L323.69 38.5432C325.245 40.7839 323.173 43.7493 320.534 43.0602L311.825 40.7855C310.996 40.5688 310.113 40.7254 309.408 41.2141L302.012 46.3449C299.772 47.8994 296.806 45.8273 297.495 43.1886L299.77 34.4795C299.987 33.6499 299.83 32.7671 299.341 32.0626L294.211 24.6667C292.656 22.426 294.728 19.4606 297.367 20.1497L306.076 22.4244C306.906 22.6411 307.788 22.4845 308.493 21.9958L315.889 16.865Z"
              fill="#FDC54E"
            />
            <path
              id="star-5"
              d="M496.306 73.9403C498.255 72.348 501.132 74.0386 500.69 76.5155L499.23 84.6907C499.09 85.4694 499.298 86.27 499.799 86.8825L505.054 93.3127C506.647 95.2608 504.956 98.1385 502.479 97.6961L494.304 96.2357C493.525 96.0966 492.725 96.3046 492.112 96.8052L485.682 102.061C483.734 103.653 480.856 101.962 481.299 99.4854L482.759 91.3102C482.898 90.5315 482.69 89.7309 482.19 89.1184L476.934 82.6883C475.342 80.7401 477.032 77.8624 479.509 78.3049L487.685 79.7652C488.463 79.9043 489.264 79.6963 489.876 79.1957L496.306 73.9403Z"
              fill="#FDC54E"
            />
            <path
              id="star-2"
              d="M482.061 330.143C485.435 328.592 488.918 332.075 487.366 335.449L482.246 346.584C481.758 347.644 481.758 348.865 482.246 349.926L487.366 361.061C488.918 364.435 485.435 367.918 482.061 366.366L470.926 361.246C469.865 360.758 468.644 360.758 467.584 361.246L456.449 366.366C453.075 367.918 449.592 364.435 451.143 361.061L456.264 349.926C456.751 348.865 456.751 347.644 456.264 346.584L451.143 335.449C449.592 332.075 453.075 328.592 456.449 330.143L467.584 335.264C468.644 335.751 469.865 335.751 470.926 335.264L482.061 330.143Z"
              fill="#AFDDFF"
            />
            <circle id="ellipse" cx="16" cy="165" r="12" stroke="#AFDDFF" stroke-width="8" />
          </g>
          <g id="glass-timer">
            <path
              id="bg-glass-2"
              d="M190 109H332V150C332 185.346 303.346 214 268 214H254C218.654 214 190 185.346 190 150V109Z"
              fill="#F9FCFF"
              fill-opacity="0.7"
            />
            <path
              id="bg-glass-1"
              d="M331 319L189 319L189 278C189 242.654 217.654 214 253 214H267C302.346 214 331 242.654 331 278V319Z"
              fill="#F0F9FF"
              fill-opacity="0.7"
            />
            <rect id="sand-down" x="256" y="110" width="10" height="209" fill="#6CBEF9" />
            <path
              id="sand-2"
              d="M194 109H327V144C327 179.346 298.346 208 263 208H258C222.654 208 194 179.346 194 144V109Z"
              fill="url(#paint0_linear)"
            />
            <path
              id="Vector 9"
              d="M203.046 122.302C203.046 122.302 200.272 148.13 206 163C209.571 172.269 219.296 184.684 219.296 184.684"
              stroke="white"
              stroke-opacity="0.4"
              stroke-width="4"
              stroke-linecap="round"
            />
            <g id="Group 13">
              <rect
                id="Rectangle 6"
                width="157"
                height="12"
                rx="6"
                transform="matrix(1 0 0 -1 182 109)"
                fill="url(#paint1_linear)"
              />
              <rect id="Rectangle 9" x="280" y="101" width="52" height="4" rx="2" fill="#93CDFF" />
            </g>
            <path
              id="sand-1"
              d="M327 319L194 319L194 284C194 248.654 222.654 220 258 220H263C298.346 220 327 248.654 327 284V319Z"
              fill="url(#paint2_linear)"
            />
            <path
              id="Vector 10"
              d="M204.189 311.746C204.189 311.746 201.271 285.984 206.251 270.997C209.356 261.654 218.009 249.038 218.009 249.038"
              stroke="white"
              stroke-opacity="0.6"
              stroke-width="4"
              stroke-linecap="round"
            />
            <g id="Group 12">
              <rect
                id="Rectangle 6_2"
                width="157"
                height="12"
                rx="6"
                transform="matrix(-1 0 0 1 339 319)"
                fill="url(#paint3_linear)"
              />
              <rect
                id="Rectangle 9_2"
                x="241"
                y="327"
                width="52"
                height="4"
                rx="2"
                transform="rotate(180 241 327)"
                fill="#93CDFF"
              />
            </g>
          </g>
        </g>
        <g id="clock">
          <path
            id="Ellipse 5"
            d="M407 330.5C407 363.913 379.913 391 346.5 391C313.087 391 286 363.913 286 330.5C286 297.087 313.087 270 346.5 270C379.913 270 407 297.087 407 330.5Z"
            fill="url(#paint4_linear)"
          />
          <path
            id="Ellipse 5 (Stroke)"
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M346.5 376.869C372.109 376.869 392.869 356.109 392.869 330.5C392.869 304.891 372.109 284.131 346.5 284.131C320.891 284.131 300.131 304.891 300.131 330.5C300.131 356.109 320.891 376.869 346.5 376.869ZM346.5 391C379.913 391 407 363.913 407 330.5C407 297.087 379.913 270 346.5 270C313.087 270 286 297.087 286 330.5C286 363.913 313.087 391 346.5 391Z"
            fill="url(#paint5_linear)"
          />
          <path
            id="Polygon 1 (Stroke)"
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M382.338 353.376L345.76 324.379L340.114 333.479L382.338 353.376Z"
            fill="url(#paint6_linear)"
          />
          <path
            id="clockwise"
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M347 290L342 337H352L347 290Z"
            fill="url(#paint7_linear)"
          />
          <path
            id="Ellipse 6"
            d="M355 331C355 335.418 351.418 339 347 339C342.582 339 339 335.418 339 331C339 326.582 342.582 323 347 323C351.418 323 355 326.582 355 331Z"
            fill="#F6A602"
          />
        </g>
      </g>
    </svg>
    <btn-play @click="onPlay" />
  </div>
</template>

<script>
import { stagger, timeline, animate } from 'motion'
import BtnPlay from './BtnPlay.vue'
let animation = []
let mainTimeline
export default {
  components: {
    BtnPlay,
  },
  data() {
    return {
      isAnimating: false,
    }
  },

  methods: {
    onPlay() {
      this.initAnimation()
    },
    initAnimation() {
      if (this.isAnimating) {
        animation.forEach(a => a && a.cancel())
        mainTimeline && mainTimeline.cancel()
        animation = []
        this.isAnimating = false
        return
      }
      this.isAnimating = true

      const sequence = []
      const hideConf = $el => [$el, { opacity: '0' }, { duration: 0 }]
      // hide element
      sequence.push(hideConf('#stars'))
      animation.push(
        animate(
          '#clockwise',
          { transform: 'translateY(-5px) rotate(360deg)' },
          { duration: 6, easing: 'linear', repeat: Infinity }
        )
      )

      sequence.push([
        '#glass-timer',
        {
          transform: ['rotate(-40deg)'],
        },
        { duration: 0.3, at: '<' },
      ])

      sequence.push([
        '#glass-timer',
        {
          transform: ['rotate(200deg)'],
        },
        { duration: 0.8 },
      ])

      sequence.push([
        '#glass-timer',
        {
          transform: ['rotate(180deg)'],
        },
        { duration: 0.2 },
      ])

      sequence.push(['#stars', { opacity: '1' }, { duration: 0 }])
      sequence.push([
        '#ellipse',
        { opacity: '0' },
        {
          duration: 0.5,
          direction: 'alternate',
          at: '<',
          repeat: 2,
          delay: 0.7,
        },
      ])

      sequence.push([
        '#star-1',
        { opacity: '0' },
        {
          duration: 0.5,
          direction: 'alternate',
          at: '<',
          repeat: 2,
          delay: 0.2,
        },
      ])

      sequence.push([
        '#star-2',
        { opacity: '0' },
        {
          duration: 0.5,
          direction: 'alternate',
          at: '<',
          repeat: 2,
          delay: 0.6,
        },
      ])

      sequence.push([
        '#star-3',
        { opacity: '0' },
        {
          duration: 0.5,
          direction: 'alternate',
          at: '<',
          repeat: 2,
          delay: 0.3,
        },
      ])

      sequence.push([
        '#star-4',
        { opacity: '0' },
        {
          duration: 0.5,
          direction: 'alternate',
          at: '<',
          repeat: 2,
          delay: 0.7,
        },
      ])

      sequence.push([
        '#star-5',
        { opacity: '0' },
        { duration: 0.5, direction: 'alternate', at: '<', delay: 0.2 },
      ])

      sequence.push([
        '#sand-1',
        {
          clipPath: 'inset(0px 0px 100% 0px)',
        },
        { duration: 1 },
      ])

      sequence.push([
        '#sand-2',
        {
          clipPath: 'inset(0px 0px 0% 0px)',
        },
        { duration: 1, at: '<' },
      ])

      sequence.push([
        '#sand-down',
        {
          clipPath: 'inset(0% 0px 55% 0px)',
        },
        { duration: 1.6, at: '<' },
      ])

      sequence.push([
        '#glass-timer',
        {
          transform: ['rotate(140deg)'],
        },
        { duration: 0.3 },
      ])

      sequence.push([
        '#glass-timer',
        {
          transform: ['rotate(380deg)'],
        },
        { duration: 0.8 },
      ])

      sequence.push([
        '#glass-timer',
        {
          transform: ['rotate(360deg)'],
        },
        { duration: 0.2 },
      ])

      sequence.push([
        '#sand-1',
        {
          clipPath: 'inset(100% 0px 0% 0px)',
        },
        { duration: 0 },
      ])

      sequence.push([
        '#sand-down',
        {
          clipPath: 'inset(20% 0px 55% 0px)',
        },
        { duration: 0 },
      ])

      sequence.push([
        '#sand-1',
        {
          clipPath: 'inset(0% 0px 0% 0px)',
        },
        { duration: 1 },
      ])

      sequence.push([
        '#sand-2',
        {
          clipPath: 'inset(100% 0px 0% 0px)',
        },
        { duration: 1, at: '<' },
      ])

      sequence.push([
        '#sand-down',
        {
          clipPath: 'inset(55% 0px 0 0px)',
        },
        { duration: 1.6, at: '<' },
      ])

      mainTimeline = timeline(sequence, { repeat: Infinity })
    },
  },
}
</script>

<style scoped>
/* svg * { */
/* transform-box: fill-box; */
/* } */

#clockwise {
  transform-origin: bottom;
  transform-box: fill-box;
  transform: translateY(-5px);
}

#glass-timer {
  transform-origin: center center;
  transform-box: fill-box;
}

#sand-1 {
  clip-path: inset(0 0px 0px 0px);
}

#sand-2 {
  clip-path: inset(0px 0px 100% 0px);
}

#sand-down {
  clip-path: inset(55% 0px 20% 0px);
}

/* #stroke-1,
#stroke-2,
#ellipse,
#star-2,
#star-3,
#star-5 {
  opacity: 0;
} */
</style>
