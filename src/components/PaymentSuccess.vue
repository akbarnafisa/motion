<template>
  <div class="main-container">
    <svg
      width="941"
      height="826"
      viewBox="0 0 941 826"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      style="width: 75%; height: 75%"
    >
      <rect width="941" height="826" fill="#E5E5E5" />
      <g id="Desktop - 1">
        <rect width="2129" height="4725" transform="translate(-158 -2148)" fill="white" />
        <g id="Group 9">
          <path
            id="Vector"
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M137.259 329.462C172.182 243.659 293.502 250.246 380.727 219.042C464.33 189.135 549.149 113.884 628.497 153.729C707.377 193.339 692.966 307.301 722.283 390.557C750.052 469.414 836.927 549.993 793.106 621.19C748.659 693.406 636.378 653.267 552.583 666.277C497.604 674.813 446.536 698.216 392.928 683.321C329.442 665.681 273.241 631.346 234.652 577.936C180.491 502.975 102.396 415.119 137.259 329.462Z"
            fill="#0C7DCE"
          />
          <g id="payment-success-stars">
            <path
              id="payment-success-star-1"
              d="M179.37 697.249C182.227 694.877 186.493 697.34 185.868 701L183.28 716.149C183.083 717.3 183.399 718.479 184.145 719.378L193.961 731.204C196.332 734.061 193.87 738.326 190.209 737.701L175.06 735.113C173.909 734.917 172.73 735.233 171.832 735.978L160.006 745.794C157.149 748.166 152.883 745.703 153.508 742.043L156.096 726.893C156.293 725.743 155.977 724.563 155.231 723.665L145.415 711.839C143.043 708.982 145.506 704.716 149.166 705.342L164.316 707.929C165.467 708.126 166.646 707.81 167.544 707.064L179.37 697.249Z"
              fill="#FDC54E"
            />
            <path
              id="payment-success-star-3"
              class="3-star-top"
              d="M138.666 169.042C139.232 165.373 144.059 164.388 146.017 167.542L152.483 177.954C153.099 178.946 154.117 179.619 155.271 179.797L167.383 181.666C171.053 182.233 172.038 187.059 168.883 189.018L158.472 195.483C157.48 196.099 156.807 197.117 156.629 198.271L154.759 210.383C154.193 214.053 149.367 215.038 147.408 211.884L140.943 201.472C140.327 200.48 139.308 199.807 138.155 199.629L126.042 197.76C122.372 197.193 121.388 192.367 124.542 190.408L134.954 183.943C135.946 183.327 136.619 182.309 136.797 181.155L138.666 169.042Z"
              fill="#FDC54E"
            />
            <path
              id="payment-success-star-4"
              d="M447.249 29.138C448.537 25.6555 453.463 25.6555 454.751 29.138L459.005 40.6321C459.41 41.727 460.273 42.5902 461.368 42.9954L472.862 47.2486C476.344 48.5372 476.344 53.4628 472.862 54.7514L461.368 59.0046C460.273 59.4098 459.41 60.273 459.005 61.3679L454.751 72.862C453.463 76.3445 448.537 76.3444 447.249 72.862L442.995 61.3679C442.59 60.273 441.727 59.4098 440.632 59.0046L429.138 54.7514C425.656 53.4628 425.656 48.5372 429.138 47.2486L440.632 42.9954C441.727 42.5902 442.59 41.727 442.995 40.6321L447.249 29.138Z"
              fill="#FDC54E"
            />
            <path
              id="payment-success-star-5"
              d="M748.64 114.05C751.515 111.701 755.762 114.196 755.109 117.851L752.954 129.916C752.749 131.065 753.056 132.247 753.795 133.151L761.55 142.64C763.9 145.515 761.405 149.762 757.75 149.109L745.685 146.954C744.536 146.749 743.354 147.056 742.45 147.794L732.961 155.55C730.086 157.9 725.839 155.405 726.492 151.75L728.647 139.685C728.852 138.536 728.545 137.354 727.807 136.45L720.051 126.961C717.701 124.086 720.196 119.839 723.851 120.492L735.916 122.647C737.065 122.852 738.247 122.545 739.151 121.806L748.64 114.05Z"
              fill="#FDC54E"
            />
            <path
              id="blink-star-1"
              d="M225.825 471.63C227.263 470.455 229.386 471.703 229.059 473.53L225.792 491.821C225.689 492.396 225.843 492.987 226.212 493.438L237.971 507.825C239.146 509.263 237.898 511.386 236.07 511.059L217.78 507.792C217.205 507.689 216.614 507.843 216.162 508.212L201.776 519.971C200.338 521.146 198.215 519.898 198.541 518.07L201.809 499.78C201.911 499.205 201.758 498.614 201.388 498.162L189.63 483.776C188.455 482.338 189.703 480.215 191.53 480.541L209.821 483.809C210.396 483.911 210.986 483.758 211.438 483.388L225.825 471.63Z"
              fill="#FFEC4A"
            />
            <path
              id="blink-star-2"
              d="M756.782 320.928C758.498 321.637 758.406 324.098 756.642 324.677L738.989 330.472C738.434 330.654 737.987 331.069 737.764 331.609L730.672 348.783C729.964 350.499 727.503 350.407 726.924 348.643L721.128 330.99C720.946 330.435 720.531 329.988 719.991 329.765L702.818 322.673C701.102 321.964 701.193 319.503 702.957 318.924L720.611 313.129C721.165 312.947 721.613 312.532 721.836 311.992L728.927 294.818C729.636 293.102 732.097 293.194 732.676 294.958L738.472 312.611C738.654 313.166 739.069 313.613 739.608 313.836L756.782 320.928Z"
              fill="#FFEC4A"
            />
            <path
              id="payment-success-star-2"
              d="M652.297 696.966C653.151 693.352 658.04 692.751 659.744 696.05L666.797 709.705C667.332 710.743 668.295 711.494 669.431 711.763L684.388 715.297C688.001 716.151 688.602 721.04 685.303 722.744L671.648 729.797C670.611 730.332 669.86 731.295 669.591 732.431L666.057 747.388C665.203 751.001 660.314 751.602 658.61 748.303L651.557 734.648C651.021 733.611 650.059 732.86 648.923 732.591L633.966 729.057C630.352 728.203 629.751 723.314 633.05 721.61L646.705 714.557C647.743 714.021 648.494 713.059 648.763 711.923L652.297 696.966Z"
              fill="#AFDDFF"
            />
            <circle id="ellipse" cx="93" cy="531" r="18" stroke="#AFDDFF" stroke-width="12" />
            <g id="stroke-2">
              <line
                id="Line 1"
                x1="860.717"
                y1="412.725"
                x2="892.302"
                y2="379.283"
                stroke="#7AC9FF"
                stroke-width="14"
                stroke-linecap="round"
              />
              <line
                id="Line 2"
                x1="848"
                y1="456.721"
                x2="911.64"
                y2="393.082"
                stroke="#F9AF47"
                stroke-width="14"
                stroke-linecap="round"
              />
            </g>
            <g id="stroke-1">
              <line
                id="Line 1_2"
                x1="39.2662"
                y1="427.286"
                x2="7.28714"
                y2="394.22"
                stroke="#7AC9FF"
                stroke-width="14"
                stroke-linecap="round"
              />
              <line
                id="Line 2_2"
                x1="82.6417"
                y1="441.981"
                x2="21.9471"
                y2="375.527"
                stroke="#F9AF47"
                stroke-width="14"
                stroke-linecap="round"
              />
            </g>
          </g>
          <g id="wallet-back">
            <rect
              id="Rectangle 2"
              width="139.764"
              height="124.045"
              rx="5"
              transform="matrix(0.987762 0.155969 0.155969 -0.987762 374.679 581.725)"
              fill="#103A92"
            />
          </g>

          <g id="coin">
            <g id="Group 8">
              <path
                id="Ellipse 1"
                d="M546 437C546 477.869 512.869 511 472 511C431.131 511 398 477.869 398 437C398 396.131 431.131 363 472 363C512.869 363 546 396.131 546 437Z"
                fill="#FCD441"
              />
              <path
                id="Ellipse 2 (Stroke)"
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M472 487.867C498.436 487.867 519.867 466.436 519.867 440C519.867 413.564 498.436 392.133 472 392.133C445.564 392.133 424.133 413.564 424.133 440C424.133 466.436 445.564 487.867 472 487.867ZM472 495C502.376 495 527 470.376 527 440C527 409.624 502.376 385 472 385C441.624 385 417 409.624 417 440C417 470.376 441.624 495 472 495Z"
                fill="#F48508"
              />
            </g>
            <path
              xmlns="http://www.w3.org/2000/svg"
              id="check"
              pathLength="1"
              d="M450 436L462.8 449.626C464.297 451.22 466.797 451.316 468.412 449.841L500 421"
              stroke="#F48508"
              stroke-width="9"
              stroke-linecap="round"
            />

            <path
              id="money"
              d="M440 453.251V420.279C440 420.101 440.093 419.934 440.241 419.839C447.401 415.228 448.75 411.708 472.417 419.993C489.674 426.033 499.409 423.453 503.029 420.84C503.404 420.57 504 420.833 504 421.301V455.646C504 455.887 503.838 456.094 503.609 456.152C497.051 457.807 490.09 462.431 469.217 454.495C453.805 448.635 444.524 451.173 440.94 453.707C440.571 453.969 440 453.71 440 453.251Z"
              fill="#F6A602"
            />
            <g id="shade">
              <path
                id="Vector 6 (Stroke)"
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M413.793 469.62C414.687 468.936 415.966 469.106 416.65 470C426.216 482.504 433.907 489.267 439.124 492.888C441.732 494.698 443.723 495.723 445.022 496.287C445.672 496.57 446.151 496.738 446.448 496.832C446.597 496.878 446.701 496.907 446.758 496.922C446.787 496.929 446.804 496.933 446.81 496.934C447.903 497.164 448.609 498.232 448.389 499.33C448.167 500.433 447.093 501.148 445.989 500.926L446.391 498.928C445.989 500.926 445.988 500.926 445.986 500.926L445.982 500.925L445.974 500.923L445.954 500.919C445.939 500.916 445.922 500.912 445.901 500.907C445.86 500.898 445.807 500.885 445.743 500.869C445.615 500.836 445.442 500.788 445.224 500.719C444.789 500.582 444.177 500.364 443.398 500.025C441.839 499.348 439.615 498.19 436.801 496.236C431.173 492.331 423.185 485.25 413.413 472.477C412.729 471.583 412.899 470.304 413.793 469.62Z"
                fill="#FFFFFA"
              />
              <path
                id="Vector 5 (Stroke)"
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M506.622 493.727C505.885 492.876 505.976 491.589 506.826 490.852C518.718 480.536 524.996 472.443 528.289 467.014C529.936 464.3 530.836 462.25 531.32 460.918C531.562 460.252 531.701 459.764 531.776 459.461C531.813 459.31 531.835 459.205 531.846 459.146C531.852 459.118 531.855 459.1 531.856 459.094C532.018 457.989 533.041 457.219 534.15 457.371C535.265 457.525 536.044 458.553 535.891 459.668L533.872 459.39C535.891 459.668 535.891 459.669 535.891 459.671L535.89 459.675L535.889 459.683L535.886 459.704C535.884 459.719 535.881 459.736 535.877 459.757C535.871 459.799 535.861 459.852 535.849 459.917C535.824 460.047 535.786 460.223 535.731 460.444C535.621 460.887 535.441 461.511 535.151 462.31C534.57 463.907 533.551 466.198 531.774 469.127C528.222 474.985 521.645 483.392 509.497 493.931C508.647 494.668 507.36 494.577 506.622 493.727Z"
                fill="#FFFFFA"
              />
              <path
                id="Vector 4 (Stroke)"
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M531.668 414.85C530.579 415.136 529.465 414.484 529.18 413.396C528.061 409.128 526.825 406.621 525.938 405.229C525.495 404.533 525.138 404.116 524.926 403.894C524.819 403.782 524.748 403.72 524.719 403.695C524.715 403.692 524.712 403.689 524.71 403.688C523.821 403.045 523.597 401.809 524.216 400.894C524.847 399.962 526.114 399.718 527.046 400.348L525.904 402.036C527.046 400.348 527.047 400.349 527.049 400.35L527.052 400.352L527.058 400.356L527.07 400.365C527.079 400.371 527.089 400.378 527.099 400.385C527.119 400.4 527.142 400.417 527.168 400.436C527.219 400.475 527.28 400.523 527.35 400.582C527.489 400.7 527.665 400.861 527.868 401.074C528.277 401.5 528.796 402.131 529.375 403.038C530.531 404.852 531.918 407.766 533.123 412.362C533.408 413.451 532.757 414.565 531.668 414.85Z"
                fill="#FFFFFA"
              />
              <path
                id="Vector 3 (Stroke)"
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M521.364 394.476C520.554 395.208 519.281 395.169 518.52 394.388C512.555 388.265 507.972 385.12 504.964 383.515C503.461 382.712 502.35 382.294 501.654 382.079C501.306 381.972 501.06 381.915 500.92 381.887C500.85 381.873 500.806 381.866 500.789 381.864C500.787 381.864 500.786 381.863 500.784 381.863C499.695 381.744 498.902 380.804 499.01 379.749C499.118 378.684 500.103 377.905 501.209 378.01L501.012 379.938C501.209 378.01 501.21 378.01 501.212 378.01L501.216 378.01L501.223 378.011L501.241 378.013C501.253 378.014 501.267 378.016 501.282 378.018C501.313 378.021 501.351 378.026 501.395 378.033C501.483 378.046 501.598 378.065 501.738 378.093C502.018 378.149 502.4 378.24 502.88 378.388C503.842 378.684 505.195 379.207 506.916 380.125C510.355 381.961 515.261 385.379 521.455 391.737C522.216 392.517 522.175 393.744 521.364 394.476Z"
                fill="#FFFFFA"
              />
              <path
                id="Vector 2 (Stroke)"
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M449.225 377.641C449.664 378.677 449.18 379.873 448.144 380.312C444.414 381.893 442.307 383.345 441.17 384.325C440.603 384.815 440.277 385.187 440.109 385.402C440.025 385.51 439.981 385.578 439.965 385.603C439.964 385.605 439.964 385.606 439.963 385.607C439.454 386.575 438.265 386.972 437.272 386.492C436.259 386.002 435.835 384.784 436.325 383.771L438.159 384.658C436.325 383.771 436.326 383.769 436.326 383.768L436.328 383.764L436.331 383.758L436.338 383.744C436.343 383.735 436.348 383.724 436.354 383.713C436.365 383.692 436.378 383.667 436.393 383.64C436.423 383.586 436.46 383.522 436.506 383.448C436.598 383.3 436.725 383.114 436.895 382.896C437.236 382.458 437.75 381.893 438.508 381.239C440.023 379.932 442.511 378.273 446.554 376.56C447.59 376.12 448.786 376.605 449.225 377.641Z"
                fill="#FFFFFA"
              />
              <path
                id="Vector 1 (Stroke)"
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M430.46 388.643C431.214 389.464 431.173 390.753 430.37 391.522C423.829 397.791 420.465 402.609 418.747 405.776C417.888 407.359 417.439 408.53 417.208 409.266C417.093 409.635 417.032 409.895 417.002 410.045C416.986 410.12 416.979 410.167 416.976 410.187C416.975 410.189 416.975 410.192 416.975 410.193C416.853 411.297 415.885 412.099 414.799 411.99C413.703 411.881 412.902 410.884 413.01 409.765L414.994 409.964C413.01 409.765 413.01 409.763 413.01 409.761L413.01 409.758L413.011 409.75L413.013 409.732C413.014 409.72 413.016 409.706 413.018 409.69C413.022 409.658 413.027 409.619 413.034 409.573C413.048 409.482 413.068 409.363 413.097 409.217C413.156 408.926 413.253 408.527 413.41 408.025C413.725 407.02 414.281 405.604 415.259 403.801C417.215 400.197 420.858 395.053 427.642 388.552C428.445 387.782 429.707 387.823 430.46 388.643Z"
                fill="#FFFFFA"
              />
            </g>
          </g>
          <g id="wallet-front">
            <g id="Group 7">
              <rect
                id="Rectangle 3"
                x="392.712"
                y="459.145"
                width="164.86"
                height="129.137"
                rx="5"
                transform="rotate(17.2857 392.712 459.145)"
                fill="#337FDD"
              />
              <rect
                id="Rectangle 4"
                x="400.627"
                y="471.64"
                width="142.732"
                height="111.588"
                rx="4.5"
                transform="rotate(17.2857 400.627 471.64)"
                stroke="#194BA5"
                stroke-dasharray="2 2"
              />
            </g>
            <g id="Group 6">
              <rect
                id="Rectangle 5"
                x="498.51"
                y="547.235"
                width="50.0046"
                height="29.7008"
                rx="4"
                transform="rotate(17.2857 498.51 547.235)"
                fill="#63A0F2"
              />
              <circle
                id="Ellipse 4"
                cx="507.374"
                cy="565.937"
                r="7.75656"
                transform="rotate(17.2857 507.374 565.937)"
                fill="white"
              />
            </g>
          </g>
        </g>
      </g>
    </svg>
    <btn-play @click="onPlay" />
  </div>
</template>

<script>
import { stagger, timeline, animate } from 'motion'
import BtnPlay from './BtnPlay.vue'
let animation = []
let mainTimeline
export default {
  components: {
    BtnPlay,
  },
  data() {
    return {
      isAnimating: false,
    }
  },
  methods: {
    onPlay() {
      this.initAnimation()
    },

    initAnimation() {
      if (this.isAnimating) {
        animation.forEach(a => a && a.cancel())
        mainTimeline && mainTimeline.cancel()
        animation = []
        this.isAnimating = false
        return
      }

      this.isAnimating = true
      const sequence = []
      const hideConf = $el => [$el, { opacity: '0' }, { duration: 0 }]

      const resetStyle = (el, style = ['opacity', 'transform']) => {
        const $el = document.querySelector(el)
        if ($el) {
          style.forEach(s => {
            $el.style[s] = null
          })
        }
      }

      resetStyle('#money')
      resetStyle('#coin')
      resetStyle('#wallet-front')
      resetStyle('#wallet-back')
      resetStyle('#payment-success-stars')
      resetStyle('#payment-success-star-1')
      resetStyle('#payment-success-star-2')
      resetStyle('#payment-success-star-3')
      resetStyle('#payment-success-star-4')
      resetStyle('#payment-success-star-5')
      resetStyle('#stroke-1')
      resetStyle('#stroke-2')
      resetStyle('#blink-star-1')
      resetStyle('#blink-star-2')
      resetStyle('#ellipse')
      resetStyle('#check', ['strokeDashoffset', 'visibility', 'opacity'])

      // hide element
      sequence.push(hideConf('#payment-success-stars'))
      sequence.push(hideConf('#coin'))
      sequence.push(hideConf('#wallet-front'))
      sequence.push(hideConf('#wallet-back'))

      sequence.push(['#wallet-front', { opacity: '1' }, { duration: 0.5 }])
      sequence.push(['#wallet-back', { opacity: '1' }, { duration: 1, at: '<' }])

      sequence.push([
        '#coin',
        {
          opacity: '1',
          transform: ['scale(3.25) translateY(-40px)'],
        },
        { duration: 0.75, at: '<' },
      ])

      sequence.push([
        '#wallet-front',
        {
          transform: ['translateY(100px) rotate(-20deg) scale(0.75)'],
        },
        { duration: 0.6, at: '<' },
      ])

      sequence.push([
        '#wallet-back',
        {
          opacity: '1',
          transform: ['translateY(100px) rotate(-20deg) scale(0.75)'],
        },
        { duration: 0.6, at: '<' },
      ])

      sequence.push([
        '#wallet-front',
        {
          transform: ['translateY(150px) rotate(10deg) scale(0.5)'],
        },
        { duration: 0.6 },
      ])

      sequence.push([
        '#wallet-back',
        {
          transform: ['translateY(150px) rotate(10deg) scale(0.5)'],
        },
        { duration: 0.6, at: '<' },
      ])

      sequence.push([
        '#wallet-front',
        {
          opacity: 0,
        },
        { duration: 0.1, at: '-.2' },
      ])

      sequence.push([
        '#wallet-back',
        {
          opacity: 0,
        },
        { duration: 0.1, at: '<' },
      ])

      sequence.push([
        '#coin',
        {
          opacity: '1',
          transform: ['scale(3.25) translateY(0) rotate(360deg)'],
        },
        { duration: 1, at: '-.35' },
      ])

      const draw = progress => ({
        strokeDashoffset: 1 - progress,
        visibility: 'visible',
        opacity: 1,
      })
      mainTimeline = timeline(sequence)
      mainTimeline.finished.then(() => {
        animation.push(animate('#money', { opacity: '0' }, { duration: 0.1 }))
        animation.push(animate('#check', draw(1), { duration: 0.6 }))
        animation.push(animate('#payment-success-stars', { opacity: '1' }, { duration: 1 }))
        animation.push(
          animate(
            '#payment-success-star-3',
            { opacity: '1' },
            { duration: 0.6, repeat: 2, direction: 'alternate', delay: 0.2 }
          )
        )
        animation.push(
          animate(
            '#payment-success-star-4',
            { opacity: '0' },
            { duration: 0.6, repeat: 2, direction: 'alternate', delay: 0.2 }
          )
        )
        animation.push(
          animate(
            '#payment-success-star-5',
            { opacity: '1' },
            { duration: 0.6, repeat: 2, direction: 'alternate', delay: 0.2 }
          )
        )

        animation.push(
          animate(
            '#stroke-2',
            { opacity: '1' },
            { duration: 0.8, repeat: 2, direction: 'alternate' }
          )
        )
        animation.push(
          animate(
            '#stroke-1',
            { opacity: '1' },
            { duration: 0.8, repeat: 2, direction: 'alternate' }
          )
        )

        animation.push(
          animate(
            '#ellipse',
            { opacity: '1' },
            { duration: 0.6, repeat: 2, direction: 'alternate', delay: 0.6 }
          )
        )

        animation.push(
          animate(
            '#payment-success-star-2',
            { opacity: '1' },
            { duration: 0.6, repeat: 2, direction: 'alternate', delay: 0.2 }
          )
        )

        animation.push(
          animate(
            '#payment-success-star-1',
            { opacity: '0' },
            { duration: 0.6, repeat: 2, direction: 'alternate', delay: 0.4 }
          )
        )

        animation.push(
          animate(
            '#blink-star-1',
            {
              opacity: '1',
              transform: [
                'rotate(0) scale(0)',
                'rotate(30deg) scale(1.5)',
                'rotate(60deg) scale(.9)',
              ],
            },
            { duration: 1.2, direction: 'alternate' }
          )
        )

        animation.push(
          animate(
            '#blink-star-2',
            {
              opacity: '1',
            },
            { duration: 0.6, direction: 'alternate' }
          )
        )
      })
    },
  },
}
</script>

<style scoped>
/* svg * { */
/* transform-box: fill-box; */
/* } */

#coin,
#wallet-back,
#wallet-front,
#blink-star-1 {
  transform-origin: center center;
  transform-box: fill-box;
}

#stroke-1,
#stroke-2,
#ellipse,
#payment-success-2,
#payment-success-3,
#payment-success-5 {
  opacity: 0;
}

#check {
  stroke-dasharray: 1;
  stroke-dashoffset: 1;
  visibility: hidden;
}
.box {
  width: 50px;
  height: 50px;
  background: #44bba4;
  margin-right: 4px;
}
</style>
