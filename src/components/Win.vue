<template>
  <div class="main-container">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="550"
      height="400"
      viewBox="0 0 550 400"
      fill="none"
    >
      <rect width="550" height="400" fill="#E5E5E5" />
      <g id="Desktop - 1">
        <rect width="2129" height="4725" transform="translate(-904 -3262)" fill="white" />
        <g id="win">
          <g id="Group">
            <g id="connector">
              <path id="connector-right" d="M300 338H277V339H300V338Z" fill="#FF9928" />
              <path id="connector-left" d="M277 338H255V339H277V338Z" fill="#FFA834" />
            </g>
            <g id="bottom">
              <path
                id="bottom-right"
                d="M307.286 367H277V368H322.429C324.55 368 326.341 367.988 327.805 367.964C329.269 367.94 330 367.91 330 367.875V367.375C330 367.271 327.788 367.183 323.363 367.11C318.939 367.037 313.58 367 307.286 367Z"
                fill="#FFCC33"
              />
              <path
                id="bottom-left"
                d="M246.714 367H277V368H231.571C229.451 368 227.66 367.988 226.196 367.964C224.732 367.94 224 367.91 224 367.875V367.375C224 367.271 226.213 367.183 230.638 367.11C235.062 367.037 240.421 367 246.714 367Z"
                fill="#FFDB40"
              />
            </g>
            <g id="base">
              <path
                id="base-right"
                d="M277 362V378H281.445C281.6 378 281.732 377.225 281.839 375.679C281.947 374.134 282 372.239 282 369.999C282 367.76 281.947 365.866 281.839 364.319C281.732 362.772 281.6 362 281.445 362H277Z"
                fill="#FF9928"
              />
              <path
                id="base-left"
                d="M277 362V378H272.556C272.401 378 272.269 377.225 272.162 375.679C272.054 374.134 272 372.239 272 369.999C272 367.76 272.054 365.866 272.162 364.319C272.269 362.772 272.401 362 272.556 362H277Z"
                fill="#FFA834"
              />
            </g>
            <path
              id="grip-left"
              d="M221.201 147.999C221.201 145.794 221.083 143.91 220.848 142.347C220.612 140.782 220.328 140 219.996 140H212.205C211.873 140 211.589 140.782 211.354 142.347C211.118 143.91 211 145.794 211 147.999V165.543C211 175.515 211.251 185.221 211.751 194.66C212.236 203.832 212.933 212.274 213.844 219.989C214.751 227.686 215.817 234.209 217.04 239.561C218.299 245.053 219.657 249.007 221.117 251.425L222.502 253.745C222.823 254.278 223.126 253.976 223.41 252.838C223.696 251.7 223.88 250.057 223.96 247.905C224.043 245.772 223.999 243.764 223.827 241.88C223.656 239.978 223.408 238.761 223.084 238.227L221.699 235.934C220.505 233.942 219.394 230.699 218.366 226.202C217.362 221.793 216.488 216.434 215.743 210.124C214.996 203.814 214.423 196.899 214.024 189.379C213.615 181.647 213.41 173.703 213.41 165.543V155.997H219.996C220.328 155.997 220.612 155.215 220.848 153.652C221.083 152.087 221.201 150.203 221.201 147.999Z"
              fill="#FFA834"
            />
            <path
              id="grip-right"
              d="M333.664 142.236C333.44 140.745 333.17 140 332.853 140H325.433C325.117 140 324.847 140.745 324.623 142.236C324.398 143.727 324.286 145.522 324.286 147.623C324.286 149.724 324.398 151.52 324.623 153.01C324.847 154.501 325.117 155.247 325.433 155.247H331.707V167.748C331.707 182.843 331.027 196.506 329.669 208.737C328.31 220.934 326.545 229.277 324.374 233.766L321.813 239.077C321.509 239.705 321.284 240.949 321.136 242.812C320.988 244.676 320.961 246.607 321.056 248.606C321.15 250.605 321.336 252.095 321.614 253.079C321.894 254.078 322.187 254.265 322.493 253.638L325.055 248.327C326.365 245.615 327.576 241.61 328.69 236.307C329.778 231.107 330.72 224.923 331.515 217.758C332.313 210.592 332.924 202.799 333.347 194.379C333.782 185.74 334 176.862 334 167.748V147.623C334 145.522 333.888 143.727 333.664 142.236Z"
              fill="#FF9928"
            />
            <g id="main">
              <path
                id="main-right"
                d="M282.956 273.598C282.966 273.446 282.924 273.312 282.829 273.198C282.735 273.083 282.615 273.017 282.468 273H276.999V285C277.675 285 278.325 284.878 278.948 284.634C279.552 284.397 280.096 284.06 280.578 283.622C281.06 283.186 281.448 282.677 281.744 282.096C282.049 281.498 282.236 280.86 282.306 280.184L282.956 273.598Z"
                fill="#FFCC33"
              />
              <path
                id="main-left"
                d="M271.042 273.598C271.031 273.446 271.073 273.312 271.168 273.198C271.262 273.083 271.382 273.017 271.529 273H276.999V285C276.322 285 275.672 284.878 275.049 284.634C274.445 284.397 273.902 284.06 273.419 283.622C272.938 283.186 272.549 282.677 272.253 282.096C271.948 281.498 271.761 280.86 271.691 280.184L271.042 273.598Z"
                fill="#FFDB40"
              />
            </g>
            <g id="star-win">
              <path
                id="Vector"
                d="M282.951 205.4C283.248 205.113 283.332 204.772 283.202 204.377C283.07 203.985 282.8 203.763 282.391 203.712L279.354 203.256L278.008 200.516C277.919 200.353 277.793 200.225 277.627 200.132C277.468 200.044 277.297 200 277.114 200V210.25L279.831 211.683C280.188 211.87 280.533 211.842 280.866 211.6C281.199 211.357 281.332 211.034 281.263 210.631L280.747 207.547L282.951 205.4Z"
                fill="#FF9928"
              />
              <path
                id="Vector_2"
                d="M271.311 205.4C271.013 205.113 270.929 204.772 271.059 204.377C271.192 203.985 271.462 203.763 271.87 203.712L274.907 203.256L276.254 200.516C276.342 200.353 276.469 200.225 276.634 200.132C276.793 200.044 276.964 200 277.147 200V210.25L274.431 211.683C274.073 211.87 273.728 211.842 273.395 211.6C273.062 211.357 272.93 211.034 272.998 210.631L273.514 207.547L271.311 205.4Z"
                fill="#FFA834"
              />
            </g>
            <g id="top">
              <path
                id="top-right"
                d="M287 128.5C287 126.121 286.926 124.108 286.777 122.465C286.629 120.822 286.447 120 286.231 120H277V137H286.231C286.447 137 286.629 136.179 286.777 134.535C286.926 132.892 287 130.881 287 128.5Z"
                fill="#FF9928"
              />
              <path
                id="top-left"
                d="M266 128.5C266 126.121 266.082 124.108 266.246 122.465C266.41 120.822 266.61 120 266.847 120H277V137H266.847C266.61 137 266.41 136.179 266.246 134.535C266.082 132.892 266 130.881 266 128.5Z"
                fill="#FFA834"
              />
            </g>
            <g id="star-win-6">
              <path
                id="Vector_3"
                d="M284.089 204.814C284.272 204.32 284.18 203.882 283.812 203.5C283.443 203.122 283.01 203.016 282.513 203.184L278.768 204.339L275.705 201.935C275.513 201.796 275.297 201.719 275.055 201.704C274.824 201.69 274.603 201.734 274.393 201.835L280.062 213.619L283.977 213.763C284.492 213.781 284.873 213.558 285.122 213.095C285.371 212.632 285.344 212.187 285.042 211.761L282.743 208.502L284.089 204.814Z"
                fill="#FF9928"
              />
              <path
                id="Vector_4"
                d="M270.711 211.164C270.212 210.995 269.93 210.647 269.866 210.121C269.805 209.595 269.997 209.193 270.44 208.913L273.699 206.736L273.765 202.842C273.778 202.606 273.855 202.389 273.996 202.192C274.131 202.005 274.305 201.861 274.516 201.761L280.083 213.594L277.725 216.723C277.414 217.133 277.001 217.289 276.485 217.19C275.968 217.09 275.64 216.789 275.5 216.286L274.421 212.446L270.711 211.164Z"
                fill="#FFA834"
              />
            </g>
            <g id="star-win-5">
              <path
                id="Vector_5"
                d="M280.089 204.814C280.272 204.32 280.18 203.882 279.812 203.5C279.443 203.122 279.01 203.016 278.513 203.184L274.768 204.339L271.705 201.935C271.513 201.796 271.297 201.719 271.055 201.704C270.824 201.69 270.603 201.734 270.393 201.835L276.062 213.619L279.977 213.763C280.492 213.781 280.873 213.558 281.122 213.095C281.371 212.632 281.344 212.187 281.042 211.761L278.743 208.502L280.089 204.814Z"
                fill="#FF9928"
              />
              <path
                id="Vector_6"
                d="M266.711 211.164C266.212 210.995 265.93 210.647 265.866 210.121C265.805 209.595 265.997 209.193 266.44 208.913L269.699 206.736L269.765 202.842C269.778 202.606 269.855 202.389 269.996 202.192C270.131 202.005 270.305 201.861 270.516 201.761L276.083 213.594L273.725 216.723C273.414 217.133 273.001 217.289 272.485 217.19C271.968 217.09 271.64 216.789 271.5 216.286L270.421 212.446L266.711 211.164Z"
                fill="#FFA834"
              />
            </g>
            <g id="star-win-4">
              <path
                id="Vector_7"
                d="M286.089 202.814C286.272 202.32 286.18 201.882 285.812 201.5C285.443 201.122 285.01 201.016 284.513 201.184L280.768 202.339L277.705 199.935C277.513 199.796 277.297 199.719 277.055 199.704C276.824 199.69 276.603 199.734 276.393 199.835L282.062 211.619L285.977 211.763C286.492 211.781 286.873 211.558 287.122 211.095C287.371 210.632 287.344 210.187 287.042 209.761L284.743 206.502L286.089 202.814Z"
                fill="#FF9928"
              />
              <path
                id="Vector_8"
                d="M272.711 209.164C272.212 208.995 271.93 208.647 271.866 208.121C271.805 207.595 271.997 207.193 272.44 206.913L275.699 204.736L275.765 200.842C275.778 200.606 275.855 200.389 275.996 200.192C276.131 200.005 276.305 199.861 276.516 199.761L282.083 211.594L279.725 214.723C279.414 215.133 279.001 215.289 278.485 215.19C277.968 215.09 277.64 214.789 277.5 214.286L276.421 210.446L272.711 209.164Z"
                fill="#FFA834"
              />
            </g>
            <g id="star-win-3">
              <path
                id="Vector_9"
                d="M279.089 200.814C279.272 200.32 279.18 199.882 278.812 199.5C278.443 199.122 278.01 199.016 277.513 199.184L273.768 200.339L270.705 197.935C270.513 197.796 270.297 197.719 270.055 197.704C269.824 197.69 269.603 197.734 269.393 197.835L275.062 209.619L278.977 209.763C279.492 209.781 279.873 209.558 280.122 209.095C280.371 208.632 280.344 208.187 280.042 207.761L277.743 204.502L279.089 200.814Z"
                fill="#FF9928"
              />
              <path
                id="Vector_10"
                d="M265.711 207.164C265.212 206.995 264.93 206.647 264.866 206.121C264.805 205.595 264.997 205.193 265.44 204.913L268.699 202.736L268.765 198.842C268.778 198.606 268.855 198.389 268.996 198.192C269.131 198.005 269.305 197.861 269.516 197.761L275.083 209.594L272.725 212.723C272.414 213.133 272.001 213.289 271.485 213.19C270.968 213.09 270.64 212.789 270.5 212.286L269.421 208.446L265.711 207.164Z"
                fill="#FFA834"
              />
            </g>
            <g id="star-win-2">
              <path
                id="Vector_11"
                d="M284.089 199.814C284.272 199.32 284.18 198.882 283.812 198.5C283.443 198.122 283.01 198.016 282.513 198.184L278.768 199.339L275.705 196.935C275.513 196.796 275.297 196.719 275.055 196.704C274.824 196.69 274.603 196.734 274.393 196.835L280.062 208.619L283.977 208.763C284.492 208.781 284.873 208.558 285.122 208.095C285.371 207.632 285.344 207.187 285.042 206.761L282.743 203.502L284.089 199.814Z"
                fill="#FF9928"
              />
              <path
                id="Vector_12"
                d="M270.711 206.164C270.212 205.995 269.93 205.647 269.866 205.121C269.805 204.595 269.997 204.193 270.44 203.913L273.699 201.736L273.765 197.842C273.778 197.606 273.855 197.389 273.996 197.192C274.131 197.005 274.305 196.861 274.516 196.761L280.083 208.594L277.725 211.723C277.414 212.133 277.001 212.289 276.485 212.19C275.968 212.09 275.64 211.789 275.5 211.286L274.421 207.446L270.711 206.164Z"
                fill="#FFA834"
              />
            </g>
            <g id="star-win-1">
              <path
                id="Vector_13"
                d="M279.089 198.814C279.272 198.32 279.18 197.882 278.812 197.5C278.443 197.122 278.01 197.016 277.513 197.184L273.768 198.339L270.705 195.935C270.513 195.796 270.297 195.719 270.055 195.704C269.824 195.69 269.603 195.734 269.393 195.835L275.062 207.619L278.977 207.763C279.492 207.781 279.873 207.558 280.122 207.095C280.371 206.632 280.344 206.187 280.042 205.761L277.743 202.502L279.089 198.814Z"
                fill="#FF9928"
              />
              <path
                id="Vector_14"
                d="M265.711 205.164C265.212 204.995 264.93 204.647 264.866 204.121C264.805 203.595 264.997 203.193 265.44 202.913L268.699 200.736L268.765 196.842C268.778 196.606 268.855 196.389 268.996 196.192C269.131 196.005 269.305 195.861 269.516 195.761L275.083 207.594L272.725 210.723C272.414 211.133 272.001 211.289 271.485 211.19C270.968 211.09 270.64 210.789 270.5 210.286L269.421 206.446L265.711 205.164Z"
                fill="#FFA834"
              />
            </g>
          </g>
        </g>
      </g>
    </svg>
    <btn-play @click="onPlay" />
  </div>
</template>

<script>
import { spring, animate } from 'motion'
import BtnPlay from './BtnPlay.vue'
let animation = []

export default {
  components: {
    BtnPlay,
  },
  mounted() {
    this.$nextTick(() => this.initAnimation())
  },

  methods: {
    onPlay() {
      this.initAnimation()
    },
    async initAnimation() {
      const hideConf = el => {
        animate(el, { opacity: 0 }, { duration: 0 })
      }

      const resetStyle = (el, style = ['opacity', 'transform', 'cssText']) => {
        const $el = document.querySelector(el)
        if ($el) {
          console.log(el, $el)
          style.forEach(s => {
            $el.style[s] = null
          })
        }
      }

      const $el = [
        '#base-right',
        '#base-left',
        '#bottom-right',
        '#bottom-left',
        '#connector-right',
        '#connector-left',
        '#main',
        '#top-right',
        '#top-left',
        '#grip-right',
        '#grip-left',
        '#star-win',
        '#star-win-1',
        '#star-win-2',
        '#star-win-3',
        '#star-win-4',
        '#star-win-5',
        '#star-win-6',
      ]

      $el.forEach(el => {
        resetStyle(el)
      })

      if (this.isAnimating) {
        animation.forEach(a => a && a.cancel())
        animation = []
        this.isAnimating = false
        return
      }
      this.isAnimating = true

      $el.forEach(el => {
        hideConf(el)
      })

      await this.sleep(100)
      animate('#base-right', { opacity: 1 }, { duration: 0 })
      animate('#base-left', { opacity: 1 }, { duration: 0 })
      animate('#base-right', { scaleX: 13 }, { easing: spring({ velocity: 200 }) })
      animate('#base-left', { scaleX: 13 }, { easing: spring({ velocity: 200 }) })

      await this.sleep(250)
      animate('#bottom-right', { opacity: 1 }, { duration: 0 })
      animate('#bottom-left', { opacity: 1 }, { duration: 0 })
      animate('#bottom-right', { scaleY: 60 }, { easing: spring({ velocity: 1000 }) })
      animate('#bottom-left', { scaleY: 60 }, { easing: spring({ velocity: 1000 }) })

      await this.sleep(100)
      animate('#connector-right', { opacity: 1 }, { duration: 0 })
      animate('#connector-left', { opacity: 1 }, { duration: 0 })
      animate('#connector-right', { scaleY: 60 }, { easing: spring({ velocity: 500 }) })
      animate('#connector-left', { scaleY: 60 }, { easing: spring({ velocity: 500 }) })

      await this.sleep(100)
      animate('#main', { opacity: 1 }, { duration: 0 })
      animate('#main', { scale: 13 }, { easing: spring({ velocity: 1 }) })

      await this.sleep(200)
      animate('#grip-right', { opacity: 1 }, { duration: 0 })
      animate('#grip-left', { opacity: 1 }, { duration: 0 })
      animate('#star-win', { opacity: 1 }, { duration: 0 })

      animate('#grip-right', { scaleX: 5 }, { easing: spring({ velocity: 10 }) })
      animate('#grip-left', { scaleX: 5 }, { easing: spring({ velocity: 10 }) })

      animate('#star-win', { scale: 5, rotate: 360 }, { easing: spring({ damping: 12 }) })

      animate('#star-win-1', { opacity: 1 }, { duration: 0 })
      animate(
        '#star-win-1',
        { scale: 3.5, rotate: 360, translateX: 150, translateY: 150 },
        { duration: 1 }
      )

      animate('#star-win-2', { opacity: 1 }, { duration: 0 })
      animate(
        '#star-win-2',
        { scale: 3.5, rotate: 360, translateX: -150, translateY: 150 },
        { duration: 1 }
      )

      await this.sleep(100)

      animate('#star-win-3', { opacity: 1 }, { duration: 0 })
      animate(
        '#star-win-3',
        { scale: 4, rotate: 360, translateX: 150, translateY: 20 },
        { duration: 1 }
      )

      animate('#star-win-4', { opacity: 1 }, { duration: 0 })
      animate(
        '#star-win-4',
        { scale: 4, rotate: 360, translateX: -150, translateY: 20 },
        { duration: 1 }
      )

      await this.sleep(100)
      animate('#star-win-5', { opacity: 1 }, { duration: 0 })
      animate(
        '#star-win-5',
        { scale: 3.5, rotate: 360, translateX: 150, translateY: -100 },
        { duration: 1 }
      )

      animate('#top-right', { opacity: 1 }, { duration: 0 })
      animate('#top-left', { opacity: 1 }, { duration: 0 })
      animate('#top-right', { scaleX: 9 }, { easing: spring({ velocity: 10 }) })
      animate('#top-left', { scaleX: 9 }, { easing: spring({ velocity: 10 }) })

      animate('#star-win-6', { opacity: 1 }, { duration: 0 })
      animate(
        '#star-win-6',
        { scale: 3.5, rotate: 360, translateX: -150, translateY: -100 },
        { duration: 1 }
      )

      await this.sleep(400)
      animate('#star-win-1', { opacity: 0 }, { duration: 0.3 })
      animate('#star-win-2', { opacity: 0 }, { duration: 0.3 })

      await this.sleep(100)
      animate('#star-win-3', { opacity: 0 }, { duration: 0.3 })
      animate('#star-win-4', { opacity: 0 }, { duration: 0.3 })

      await this.sleep(100)
      animate('#star-win-5', { opacity: 0 }, { duration: 0.3 })
      animate('#star-win-6', { opacity: 0 }, { duration: 0.3 })
    },
    sleep(ms) {
      return new Promise(resolve => {
        setTimeout(() => {
          resolve()
        }, ms)
      })
    },
  },
}
</script>

<style scoped>
#base-right,
#grip-right,
#top-right {
  transform-origin: left;
  transform-box: fill-box;
}

#base-left,
#grip-left,
#top-left {
  transform-origin: right;
  transform-box: fill-box;
}

#star-win {
  transform-origin: center;
  transform-box: fill-box;
}

#star-win-1,
#star-win-3,
#star-win-5 {
  transform-origin: left;
  transform-box: fill-box;
}

#star-win-2,
#star-win-4,
#star-win-6 {
  transform-origin: right;
  transform-box: fill-box;
}

#bottom-right,
#bottom-left,
#connector-right,
#connector-left,
#main {
  transform-origin: bottom;
  transform-box: fill-box;
}
</style>
